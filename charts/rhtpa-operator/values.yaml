# Red Hat Trusted Profile Analyzer (RHTPA) Operator Configuration
# Uses the RHTPA Operator to deploy and manage Trustification services
# Integrates with Zero Trust architecture: SPIRE, Vault, Keycloak, NooBaa

rhtpa:
  # Enable/disable RHTPA deployment
  enabled: true
  
  # TrustedProfileAnalyzer CR name
  name: "trusted-profile-analyzer"
  
  # Namespace for RHTPA deployment
  namespace: trusted-profile-analyzer
  
  # Route hostname prefix
  # This prefix is prepended to the cluster domain to form the route hostname
  # NOTE: Due to RHTPA operator bug, "server" is prepended to the result
  # Example: "trustify" with domain "apps.domain.com" generates: servertrustify.apps.domain.com
  routePrefix: "trustify"
  
  # Zero Trust Integration
  zeroTrust:
    vault:
      enabled: true
      url: "https://vault.vault.svc.cluster.local:8200" 
      role: "rhtpa"
      policy: "global-secret"
      secretPath: "secret/data/global/rhtpa"
    keycloak:
      enabled: true
      url: ""  # Constructed dynamically from global.localClusterDomain in templates
      realm: "ztvp"
      namespace: "keycloak-system"  # Namespace where Keycloak is deployed
      instanceName: "keycloak"  # Name of the Keycloak CR
      userPasswordVaultKey: "secret/data/global/keycloak-users"  # Vault path for RHTPA user password
      # OIDC Client Configuration
      clients:
        frontend:
          clientId: "rhtpa-frontend"  # Public client for RHTPA UI
        cli:
          clientId: "rhtpa-cli"  # Confidential client for RHTPA CLI/API
          secretName: "rhtpa-oidc-cli-secret"  # Kubernetes secret containing client secret
  
  # TLS Configuration
  tls:
    ingressCA:
      enabled: true  # Mount OpenShift ingress CA certificate
      certificate: ""  # PEM-encoded certificate (optional: provide custom CA directly)
      # Custom ingress CA source (optional)
      # If certificate is provided above, these settings are ignored
      # If not provided, the job will attempt to auto-detect from OpenShift ingress
      customSource:
        enabled: false  # Enable to use a custom secret instead of auto-detection
        secretName: ""  # Name of the secret containing the CA certificate
        secretNamespace: "openshift-ingress"  # Namespace where the secret is located
        secretKey: "tls.crt"  # Key in the secret containing the certificate

  # NEW: Module Configuration (Ported from AWS Config)
  modules:
    # Enable Database Creation Module
    createDatabase:
      enabled: true

    # Enable Importers Module
    createImporters:
      enabled: true
      importers:
        # Default importers (enabled by default)
        cve:
          cve:
            description: CVE list v5
            disabled: false
            period: 1d  # Supported: 15m, 30m, 1h, 6h, 12h, 1d
            source: https://github.com/CVEProject/cvelistV5
        osv-github:
          osv:
            description: GitHub Advisory Database
            disabled: false
            path: advisories
            period: 1d  # Supported: 15m, 30m, 1h, 6h, 12h, 1d
            source: https://github.com/github/advisory-database
        # Additional importers (disabled by default - enable via values-hub.yaml)
        redhat-csaf:
          csaf:
            description: All Red Hat CSAF data
            disabled: true  # Large dataset - enable via override if needed
            fetchRetries: 50
            period: 1d
            source: redhat.com
        quay-redhat-user-workloads:
          quay:
            description: SBOMs from konflux image attachments
            disabled: true  # Enable via override to import Konflux/RHTAP SBOMs
            period: 1d
            registry: quay.io
        redhat-sboms:
          sbom:
            description: All Red Hat SBOMs
            disabled: true  # Large dataset - enable via override if needed
            period: 1d
            source: https://access.redhat.com/security/data/sbom/beta/

    # Configure Importer Runtime
    importer:
      replicas: 1
      resources:
        requests:
          cpu: 0.5
          memory: 4Gi
        limits:
          cpu: 1.0
          memory: 8Gi

    # Configure API Server Runtime
    server:
      replicas: 1
      resources:
        requests:
          cpu: 0.5
          memory: 4Gi
        limits:
          cpu: 1.0
          memory: 8Gi
  
  # PostgreSQL Database Configuration
  database:
    create: true
    name: "rhtpa"
    username: "rhtpa"
    secretName: "rhtpa-db-secret"
    passwordVaultKey: "secret/data/global/rhtpa"
    storageSize: "10Gi"
    image: "registry.redhat.io/rhel8/postgresql-16"
  
  # Object Storage Configuration (NooBaa MCG)
  objectStorage:
    enabled: true
    region: "us-east-1"  # NooBaa default region
    endpoint: "s3.openshift-storage.svc:443"  # NooBaa MCG S3 endpoint (without https:// prefix)
    objectBucketClaim:
      name: "rhtpa-s3-storage"
      bucketName: "trustify"
      storageClass: "openshift-storage.noobaa.io"
  
  # Monitoring configuration
  monitoring:
    enabled: true
  
  # External access configuration
  externalAccess:
    enabled: true
# Global Configuration
global:
  imageRegistry: registry.redhat.io
  secretStore:
    name: "vault-backend"
    kind: "ClusterSecretStore"

