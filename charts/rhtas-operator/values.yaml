# Red Hat Trusted Artifact Signer (RHTAS) Operator Configuration
# Uses the RHTAS Operator to deploy and manage RHTAS components
# Integrates with Zero Trust architecture: SPIRE, Vault, Keycloak

global:
  secretStore:
    name: vault-backend
    kind: ClusterSecretStore
    backend: secret/data
  imageRegistry: registry.redhat.io

rhtas:
  namespace: trusted-artifact-signer
  
  # Zero Trust Integration
  # Note: Both SPIFFE and Keycloak issuers can be enabled simultaneously
  zeroTrust:
    spire:
      enabled: true  # Enable SPIFFE issuer for workload identity
      trustDomain: "apps.example.com"
      # IMPORTANT: This URL must match the 'iss' claim in JWT-SVIDs issued by SPIRE
      # SPIRE uses the external route URL (apps.example.com), not the internal service URL
      oidcDiscoveryUrl: "https://spire-spiffe-oidc-discovery-provider.apps.example.com"
    keycloak:
      enabled: true  # Enable Keycloak issuer for user/email authentication
      url: "https://keycloak.apps.example.com"  # MUST be public route URL (overridden in values-hub.yaml)
      realm: "ztvp"
  
  # Fulcio-specific configuration
  fulcio:
    # OIDC Issuer configuration - both can be enabled simultaneously
    # Each issuer type can be independently enabled/disabled via zeroTrust flags
    oidcIssuers:
      spiffe:
        clientID: "sigstore"
        type: "spiffe"
      keycloak:
        clientID: "trusted-artifact-signer"
        type: "email"

  # Securesign Configuration - Main RHTAS Operator Resource
  securesign:
    enabled: true
    name: "trusted-artifact-signer"
  
  # Certificate configuration for Fulcio and TSA
  certificate:
    organizationName: "Red Hat Zero Trust Validated Patterns"
    organizationEmail: "ztvp-arch-group@redhat.com"
    commonName: "fulcio"
  
  # Monitoring configuration
  monitoring:
    enabled: true
  
  # External access configuration
  externalAccess:
    enabled: true
  
  # Database configuration for Trillian
  database:
    create: true
  
  # TUF configuration
  tuf:
    enabled: true
    storageSize: "1Gi"
    accessModes:
      - ReadWriteOnce
    keys:
      - "rekor.pub"
      - "ctfe.pub" 
      - "fulcio_v1.crt.pem"
      - "tsa.certchain.pem"
  
  # Timestamp Authority configuration
  tsa:
    enabled: true
    ntpMonitoring:
      enabled: true
    certificate:
      organizationName: "Red Hat Zero Trust Validated Patterns"
      organizationEmail: "ztvp-arch-group@redhat.com"
      commonName: "tsa"
